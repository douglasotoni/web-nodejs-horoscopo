// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

// Configuração para o seed
// O Prisma procura automaticamente por prisma/seed.ts

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Sign {
  aries
  taurus
  gemini
  cancer
  leo
  virgo
  libra
  scorpio
  sagittarius
  capricorn
  aquarius
  pisces
}

enum Weekday {
  monday
  tuesday
  wednesday
  thursday
  friday
  saturday
  sunday
}

enum UserRole {
  admin
  editor
  viewer
}

enum PredictionStatus {
  draft
  published
}

model User {
  id           Int      @id @default(autoincrement())
  name         String
  email        String   @unique
  passwordHash String   @map("password_hash")
  role         UserRole @default(viewer)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  auditLogs AuditLog[]

  @@map("users")
}

model DailyPrediction {
  id                    Int                  @id @default(autoincrement())
  sign                  Sign
  weekday               Weekday
  isoWeek               Int                  @map("iso_week")
  isoYear               Int                  @map("iso_year")
  text                  String               @db.Text
  luckyNumber           Int                  @map("lucky_number")
  element               String? // fogo, terra, ar, água
  quality               String? // cardinal, fixo, mutável
  rulingPlanet          String? // planeta regente
  luckyColor            String?              @map("lucky_color") // cor da sorte
  emotion               String? // emoção específica
  practicalAdvice       String?              @map("practical_advice") // conselho prático
  compatibleSigns       String?              @map("compatible_signs") // signos compatíveis
  numerologyMeaning     String?              @map("numerology_meaning") // significado numerológico
  impactPhrase          String?              @map("impact_phrase") // frase de impacto
  recommendedActivities String?              @map("recommended_activities") // atividades recomendadas
  dailyAlert            String?              @map("daily_alert") // alerta do dia
  energyLevel           Int?                 @map("energy_level") // energia do dia (1-10)
  crystal               String? // pedra/cristal do dia
  mantra                String? // mantra ou afirmação
  loveAdvice            String?              @map("love_advice") // conselho amoroso específico
  careerAdvice          String?              @map("career_advice") // conselho profissional
  status                PredictionStatus     @default(draft)
  createdAt             DateTime             @default(now()) @map("created_at")
  updatedAt             DateTime             @updatedAt @map("updated_at")
  CareerAdvice          CareerAdvice?        @relation(fields: [careerAdviceId], references: [id])
  careerAdviceId        Int?
  LoveAdvice            LoveAdvice?          @relation(fields: [loveAdviceId], references: [id])
  loveAdviceId          Int?
  Crystal               Crystal?             @relation(fields: [crystalId], references: [id])
  crystalId             Int?
  DailyAlert            DailyAlert?          @relation(fields: [dailyAlertId], references: [id])
  dailyAlertId          Int?
  RecommendedActivity   RecommendedActivity? @relation(fields: [recommendedActivityId], references: [id])
  recommendedActivityId Int?
  PracticalAdvice       PracticalAdvice?     @relation(fields: [practicalAdviceId], references: [id])
  practicalAdviceId     Int?
  LuckyColor            LuckyColor?          @relation(fields: [luckyColorId], references: [id])
  luckyColorId          Int?
  Emotion               Emotion?             @relation(fields: [emotionId], references: [id])
  emotionId             Int?
  ImpactPhrase          ImpactPhrase?        @relation(fields: [impactPhraseId], references: [id])
  impactPhraseId        Int?
  Mantra                Mantra?              @relation(fields: [mantraId], references: [id])
  mantraId              Int?

  @@unique([sign, weekday, isoWeek, isoYear])
  @@index([sign, weekday, isoWeek, isoYear])
  @@map("daily_predictions")
}

model WeeklyPrediction {
  id          Int              @id @default(autoincrement())
  sign        Sign
  isoWeek     Int              @map("iso_week")
  isoYear     Int              @map("iso_year")
  text        String           @db.Text
  luckyNumber Int              @map("lucky_number")
  status      PredictionStatus @default(draft)
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")

  @@unique([sign, isoWeek, isoYear])
  @@index([sign, isoWeek, isoYear])
  @@map("weekly_predictions")
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  userId    Int?     @map("user_id")
  action    String
  entity    String
  entityId  Int?     @map("entity_id")
  metadata  Json?    @db.Json
  createdAt DateTime @default(now()) @map("created_at")

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId, createdAt])
  @@map("audit_logs")
}

// Tabela de referência dos signos com informações imutáveis
model ZodiacSign {
  id           Int      @id @default(autoincrement())
  name         Sign     @unique // aries, taurus, etc
  displayName  String   @map("display_name") // Áries, Touro, etc
  element      String // fogo, terra, ar, água
  quality      String // cardinal, fixo, mutável
  rulingPlanet String   @map("ruling_planet") // Marte, Vênus, etc
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  careerAdvices         CareerAdvice[]
  loveAdvices           LoveAdvice[]
  crystals              Crystal[]
  dailyAlerts           DailyAlert[]
  recommendedActivities RecommendedActivity[]
  practicalAdvices      PracticalAdvice[]
  luckyColors           LuckyColor[]
  emotions              Emotion[]
  impactPhrases         ImpactPhrase[]
  mantras               Mantra[]

  @@map("zodiac_signs")
}

// Variações de conselhos profissionais
model CareerAdvice {
  id        Int      @id @default(autoincrement())
  signId    Int      @map("sign_id")
  text      String   @db.Text
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  sign             ZodiacSign        @relation(fields: [signId], references: [id], onDelete: Cascade)
  dailyPredictions DailyPrediction[]

  @@index([signId, isActive])
  @@map("career_advices")
}

// Variações de conselhos amorosos
model LoveAdvice {
  id        Int      @id @default(autoincrement())
  signId    Int      @map("sign_id")
  text      String   @db.Text
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  sign             ZodiacSign        @relation(fields: [signId], references: [id], onDelete: Cascade)
  dailyPredictions DailyPrediction[]

  @@index([signId, isActive])
  @@map("love_advices")
}

// Variações de cristais/pedras
model Crystal {
  id        Int      @id @default(autoincrement())
  signId    Int      @map("sign_id")
  text      String   @db.Text
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  sign             ZodiacSign        @relation(fields: [signId], references: [id], onDelete: Cascade)
  dailyPredictions DailyPrediction[]

  @@index([signId, isActive])
  @@map("crystals")
}

// Variações de alertas do dia
model DailyAlert {
  id        Int      @id @default(autoincrement())
  signId    Int      @map("sign_id")
  text      String   @db.Text
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  sign             ZodiacSign        @relation(fields: [signId], references: [id], onDelete: Cascade)
  dailyPredictions DailyPrediction[]

  @@index([signId, isActive])
  @@map("daily_alerts")
}

// Variações de atividades recomendadas
model RecommendedActivity {
  id        Int      @id @default(autoincrement())
  signId    Int      @map("sign_id")
  text      String   @db.Text
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  sign             ZodiacSign        @relation(fields: [signId], references: [id], onDelete: Cascade)
  dailyPredictions DailyPrediction[]

  @@index([signId, isActive])
  @@map("recommended_activities")
}

// Variações de conselhos práticos
model PracticalAdvice {
  id        Int      @id @default(autoincrement())
  signId    Int      @map("sign_id")
  text      String   @db.Text
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  sign             ZodiacSign        @relation(fields: [signId], references: [id], onDelete: Cascade)
  dailyPredictions DailyPrediction[]

  @@index([signId, isActive])
  @@map("practical_advices")
}

// Variações de cores da sorte
model LuckyColor {
  id        Int      @id @default(autoincrement())
  signId    Int      @map("sign_id")
  text      String   @db.Text
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  sign             ZodiacSign        @relation(fields: [signId], references: [id], onDelete: Cascade)
  dailyPredictions DailyPrediction[]

  @@index([signId, isActive])
  @@map("lucky_colors")
}

// Variações de emoções
model Emotion {
  id        Int      @id @default(autoincrement())
  signId    Int      @map("sign_id")
  text      String   @db.Text
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  sign             ZodiacSign        @relation(fields: [signId], references: [id], onDelete: Cascade)
  dailyPredictions DailyPrediction[]

  @@index([signId, isActive])
  @@map("emotions")
}

// Variações de frases de impacto (por signo)
model ImpactPhrase {
  id        Int      @id @default(autoincrement())
  signId    Int      @map("sign_id")
  text      String   @db.Text
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  sign             ZodiacSign        @relation(fields: [signId], references: [id], onDelete: Cascade)
  dailyPredictions DailyPrediction[]

  @@index([signId, isActive])
  @@map("impact_phrases")
}

// Variações de mantras (por signo)
model Mantra {
  id        Int      @id @default(autoincrement())
  signId    Int      @map("sign_id")
  text      String   @db.Text
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  sign             ZodiacSign        @relation(fields: [signId], references: [id], onDelete: Cascade)
  dailyPredictions DailyPrediction[]

  @@index([signId, isActive])
  @@map("mantras")
}
